<html>
  <body>
    <div>
      Original Request:
      <pre id="og-req"></pre>
    </div>
    <div>
      Modified Request:
      <pre id="req"></pre>
    </div>
    <div>
      Original Response:
      <pre id="og-res"></pre>
    </div>
    <div>
      Modified Response:
      <pre id="res"></pre>
    </div>
    <script src="../../lib/index.umd.js"></script>
    <script>
      let qs = new URLSearchParams(window.location.search)
      let id = qs.get('id') || 1
      let fetchReqInit = { headers: new Headers({ 'x-debug': true }) }
      let url = `https://jsonplaceholder.typicode.com/users/${id}`

      document.getElementById('og-req').innerText = url

      function request(req) {
        let reqInit = {}

        for (let opt in req) {
          reqInit[opt] = req[opt]
        }

        let mReq = new Request(req.url, reqInit)

        document.getElementById('req').innerText = mReq.url

        return mReq
      }

      let REDACTED = 'REDACTED'

      function modify(user) {
        user.email = REDACTED
        user.name = REDACTED
        user.address.street = REDACTED
        user.address.suite = REDACTED
        user.address.city = REDACTED
        user.address.zipcode = REDACTED
        user.address.geo.lat = REDACTED
        user.address.geo.lng = REDACTED
        user.phone = REDACTED

        return user
      }

      async function response(res) {
        let _originalRes = res.clone()

        let json = await res.json()

        document.getElementById('og-res').innerText =
          res.url + '\n' + JSON.stringify(json, null, 2)

        let mJson = modify(json)
        let mRes = new Response(JSON.stringify(mJson))

        document.getElementById('res').innerText =
          mRes.url + '\n' + JSON.stringify(mJson, null, 2)

        return mRes
      }

      httpHook.attach({ request, response })

      console.log('[REQ] fetch', url, fetchReqInit)

      fetch(url, fetchReqInit).then(r => console.log('[RES] fetch', r))
    </script>
  </body>
</html>
